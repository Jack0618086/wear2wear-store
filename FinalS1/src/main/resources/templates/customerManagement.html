<!-- 後台管理員前端 -->
<!DOCTYPE html>
<html lang="zh-TW">
<head th:include="CMShead">
</head>
<body>
<title>後台管理員聊天</title>

<!-- 通知按鈕 -->
<button id="adminChatButton" class="btn btn-warning" style="width: 160px; height: 60px; right: 20px; bottom: 20px;">新訊息，點擊查看</button>

<!-- 管理員聊天窗口 -->
<div id="adminchatWindow">
    <div class="chat-header">
        聊天
        <button type="button" class="close" onclick="closeChat()">&times;</button>
    </div>
    <div class="chat-body" id="adminChatBox" style="height: 300px; overflow-y: auto;">
        <!-- 聊天內容 -->
    </div>
    <div class="chat-footer">
        <input type="text" id="adminmessageInput" class="form-control" placeholder="輸入消息...">
        <button type="button" class="btn btn-primary ml-2" onclick="sendAdminMessage()">發送</button>
    </div>
</div>


<script>
    var adminSocket = new WebSocket("ws://localhost:8080/chat?admin=true");

    adminSocket.onmessage = function(event) {
        var chatBox = document.getElementById("adminChatBox");
        chatBox.innerHTML += "<p>" + event.data + "</p>"; // 显示收到的消息
        chatBox.scrollTop = chatBox.scrollHeight; // 保持滚动到底部
    };

    // 打开聊天窗口
    document.getElementById("adminChatButton").addEventListener("click", function() {
        document.getElementById("adminchatWindow").style.display = "block"; // 显示聊天窗口
    });

    function sendAdminMessage() {
        var input = document.getElementById("adminmessageInput");
        var message = input.value;
        var targetUUID = prompt("请输入要发送消息的用户 UUID"); // 管理员输入目标用户的 UUID
        if (message.trim() !== "" && targetUUID) {
            adminSocket.send(targetUUID + ":" + message); // 发送给指定用户
            input.value = ""; // 清空输入框
        }
    }

    function closeChat() {
        document.getElementById("adminchatWindow").style.display = "none"; // 隐藏聊天窗口
        adminSocket.close(); // 关闭 WebSocket
    }
</script>

<footer th:include="CMSfooter"></footer>
</body>
</html>
